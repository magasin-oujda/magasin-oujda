<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Camisetas</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Tienda de Camisetas</h1>
    </header>

    <!-- Formulario para realizar un pedido -->
    <section id="order-form-section">
        <h2>Realiza tu pedido</h2>
        <form id="order-form">
            <label for="name">Nombre:</label>
            <input type="text" id="name" required>

            <label for="address">Dirección:</label>
            <input type="text" id="address" required>

            <label for="product">Producto:</label>
            <input type="text" id="product" required>

            <label for="price">Precio:</label>
            <input type="number" id="price" required>

            <button type="submit">Realizar Pedido</button>
        </form>
    </section>

    <!-- Tabla para mostrar los pedidos -->
    <section id="orders-section">
        <h2>Pedidos Realizados</h2>
        <table id="orders-table">
            <!-- Los pedidos se agregarán aquí -->
        </table>
    </section>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAviLwnV_eQ7yU6qP3cAbMTgx7G3sQBwDg",
            authDomain: "tienda-camisetas-bfaa6.firebaseapp.com",
            databaseURL: "https://tienda-camisetas-bfaa6-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "tienda-camisetas-bfaa6",
            storageBucket: "tienda-camisetas-bfaa6.firebasestorage.app",
            messagingSenderId: "287261715035",
            appId: "1:287261715035:web:784d4000cc211f72cc6d7e",
            measurementId: "G-VD308N9GE9"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase();

        // Función para guardar un pedido en Firebase
        function saveOrder(order) {
            const orderRef = ref(db, 'orders/' + order.id);
            set(orderRef, {
                customerName: order.name,
                customerAddress: order.address,
                product: order.product,
                price: order.price
            });
        }

        // Función para obtener todos los pedidos desde Firebase
        function getOrders() {
            const ordersRef = ref(db, 'orders');
            get(ordersRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const orders = snapshot.val();
                    displayOrders(orders);
                } else {
                    console.log("No hay pedidos");
                }
            }).catch((error) => {
                console.error(error);
            });
        }

        // Función para mostrar los pedidos en una tabla
        function displayOrders(orders) {
            const ordersTable = document.getElementById("orders-table");
            ordersTable.innerHTML = ""; // Limpiar la tabla

            // Agregar los encabezados de la tabla
            const headerRow = document.createElement("tr");
            headerRow.innerHTML = `
                <th>ID</th>
                <th>Nombre</th>
                <th>Dirección</th>
                <th>Producto</th>
                <th>Precio</th>
            `;
            ordersTable.appendChild(headerRow);

            // Recorrer los pedidos y agregarlos a la tabla
            for (let orderId in orders) {
                const order = orders[orderId];
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${orderId}</td>
                    <td>${order.customerName}</td>
                    <td>${order.customerAddress}</td>
                    <td>${order.product}</td>
                    <td>${order.price}</td>
                `;
                ordersTable.appendChild(row);
            }
        }

        // Enviar el pedido cuando se complete el formulario
        document.getElementById("order-form").addEventListener("submit", function(e) {
            e.preventDefault();

            const name = document.getElementById("name").value;
            const address = document.getElementById("address").value;
            const product = document.getElementById("product").value;
            const price = document.getElementById("price").value;

            // Generar un ID único para el pedido
            const orderId = new Date().getTime();

            // Guardar el pedido en Firebase
            saveOrder({
                id: orderId,
                name: name,
                address: address,
                product: product,
                price: price
            });

            alert("¡Pedido realizado exitosamente!");
        });

        // Llamar a la función para obtener los pedidos cuando se carga la página
        window.onload = function() {
            getOrders();
        };
    </script>
</body>
</html>
